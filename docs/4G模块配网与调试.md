4g-connect.sh

```bash
#!/bin/sh

# 定义4G模块的串口设备
MODEM_PORT="/dev/ttyUSB2"
# 定义运营商APN
APN="wonet" # 中国联通（sim卡的运营商）

echo "--- 4G Connection Script Started ---"

# 1. 等待串口设备出现
#    -c 表示检查文件是否存在并且是一个字符设备
echo "Waiting for modem device ${MODEM_PORT}..."
while [ ! -c "$MODEM_PORT" ]; do
  sleep 1
done
echo "Modem device found."

# 2. 发送AT指令进行配置和拨号
#    增加延时以确保模块有足够的时间处理每个命令
send_at_command() {
  echo "Sending: $1"
  echo -e "$1\r\n" > $2
  sleep 2 # 每个指令后等待2秒
}

# 关闭回显，简化输出
send_at_command "ATE0" "$MODEM_PORT"

# 检查SIM卡状态 (可选，用于调试)
# send_at_command "AT+CPIN?" "$MODEM_PORT"

# 设置APN (即使已保存，也建议每次都设置以确保正确)
send_at_command "AT+CGDCONT=1,\"IP\",\"${APN}\"" "$MODEM_PORT"

# 启动数据连接
send_at_command "AT+MDIALUP=1,1" "$MODEM_PORT"

echo "--- 4G Connection Script Finished ---"

# 可以在后台启动一个cat进程，将模块输出记录到日志，方便调试
# cat "$MODEM_PORT" > /var/log/modem.log &
```

验证这个脚本成功后可以把它设为启动任务，每次开机后自动配网



该开发板的4g对应的网络设备是eth2，通过以下指令检测是否能上网

```bash
ping -I eth2 8.8.8.8
```

